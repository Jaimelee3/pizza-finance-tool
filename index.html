<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üçï AI Pizza Finance Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; }
    .container { max-width: 750px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,.08); }
    h1 { text-align: center; color: #c85151; }
    label { display: block; margin-top: 12px; font-weight: 600; }
    input, select, button { width: 100%; padding: 10px; margin-top: 6px; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #c85151; color: #fff; font-weight: bold; cursor: pointer; }
    button:hover { filter: brightness(0.95); }
    .result { margin-top: 20px; padding: 15px; background: #111; color: #eee; border-radius: 8px; white-space: pre-wrap; }
    table { border-collapse: collapse; margin-top: 15px; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
    .disclaimer { margin-top: 20px; font-size: 14px; color: #555; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üçï AI Pizza Finance Tool</h1>
    <label>Investment Amount ($):</label>
    <input id="amount" type="number" placeholder="e.g., 5000" />

    <label>Risk Preference:</label>
    <select id="risk">
      <option value="low">Low</option>
      <option value="medium" selected>Medium</option>
      <option value="high">High</option>
    </select>

    <label>Your OpenAI API Key (starts with sk-):</label>
    <input id="apikey" type="password" placeholder="Paste your key here" />

    <button id="go">Get Portfolio</button>

    <div id="pretty"></div>
    <div id="output" class="result">Waiting‚Ä¶</div>

    <div class="disclaimer">
      ‚ö†Ô∏è Disclaimer: This tool is for educational/demo purposes only and not financial advice.  
      It uses AI analogies (pizza toppings) to explain portfolio risk. Don‚Äôt bet your rent money on pineapple üçç.
    </div>
  </div>

  <script>
    async function getBTCPrice() {
      try {
        const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
        const data = await res.json();
        return data.bitcoin.usd;
      } catch { return "N/A"; }
    }

    function renderTable(json) {
      if (!json.safe_pizza && !json.spicy_pizza) return "";
      const buildRows = (obj) => Object.entries(obj).map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`).join("");
      return `
        <h3>Safe Pizza üçï</h3>
        <table><tr><th>Topping</th><th>Allocation</th></tr>${buildRows(json.safe_pizza)}</table>
        <h3>Spicy Pizza üå∂Ô∏èüçï</h3>
        <table><tr><th>Topping</th><th>Allocation</th></tr>${buildRows(json.spicy_pizza)}</table>
        <p><em>${json.explanation || ""}</em></p>
      `;
    }

    document.getElementById("go").addEventListener("click", async () => {
      const amount = document.getElementById("amount").value.trim();
      const risk = document.getElementById("risk").value;
      const apiKey = document.getElementById("apikey").value.trim();
      const output = document.getElementById("output");
      const pretty = document.getElementById("pretty");
      pretty.innerHTML = "";

      if (!amount || !risk || !apiKey) {
        output.textContent = "‚ùå Please fill in all fields.";
        return;
      }

      output.textContent = "üçï Thinking...";

      const btcPrice = await getBTCPrice();
      const prompt = `
      You are a funny but smart financial advisor who only explains investments using pizza toppings.

      The user has $${amount} and their risk preference is "${risk}".

      Create two pizza portfolio scenarios:
      1. Safe Pizza (conservative allocation)
      2. Spicy Pizza (higher-risk allocation)

      Use toppings:
      - Pepperoni = Stocks
      - Cheese = Bonds
      - Pineapple = Crypto
      - Crust = Savings

      Rules:
      - Output STRICT JSON (no extra text)
      - Keys: safe_pizza, spicy_pizza, explanation
      - Values for allocations must be percentages with labels
      - Mention live Bitcoin price = $${btcPrice}
      `;

      try {
        const resp = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: prompt }],
            temperature: 0.8
          })
        });

        const data = await resp.json();
        const content = data?.choices?.[0]?.message?.content || "";

        let json;
        try { json = JSON.parse(content); } catch { json = null; }

        if (json) {
          pretty.innerHTML = renderTable(json);
        }
        output.textContent = content || JSON.stringify(data, null, 2);
      } catch (err) {
        output.textContent = "‚ö†Ô∏è Error: " + err.message;
      }
    });
  </script>
</body>
</html>
